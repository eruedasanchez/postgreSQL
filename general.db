




*--- Creacion de una tabla a partir de otra tabla ---* 

*--- Comenzamos viendo de la tabla empleados, la cantidad distintas de puestos
ejecutando el siguiente comando: ---*

SELECT DISTINCT puesto FROM empleados

*--- Ahora, vamos a crear una tabla llamada puestos con una columna
que contiene los distintos puestos, donde los distintos puestos
los extraemos de la tabla empleados. 
A esto, lo llamamos creacion de una tabla a partir de otra tabla ---*

CREATE TABLE puestos AS SELECT DISTINCT puesto FROM empleados

*--- Por lo tanto, vemos los distintos puestos de la nueva tabla puestos ---*

SELECT * FROM puestos

*--- Ahora, vamos a crear una tabla llamada 'rango a' que va a 
almacenar los registros de aquellos empleados donde su sueldo es
mayor o igual que 5000. Lo hacemos ejecutando el siguiente
comando: ---* 

CREATE TABLE rangoA 
AS SELECT nombre, apellidopaterno, apellidomaterno, edad, sueldo, puesto 
FROM empleados WHERE sueldo >= 5000

*--- Creacion de una tabla a partir de otras tablas usando JOINs ---*

*--- Comenzamos creando la tabla vendedor de la siguiente manera: ---*

CREATE TABLE vendedor(
id INTEGER,
nombre VARCHAR(45),
apellidopaterno VARCHAR(45),
apellidomaterno VARCHAR(45),
antiguedad DATE,
ciudad VARCHAR(45),
estado VARCHAR(45),
telefono VARCHAR(12));

*--- Luego, insertamos los siguientes datos: ---*

INSERT INTO vendedor(id,nombre,apellidopaterno,apellidomaterno,antiguedad,ciudad,
estado,telefono) VALUES(1000,'Juan','Vazquez','Perez','2020-05-08','Guadalajara','Jalisco',
'1234564343'),(1001,'Juan','Vazquez','Perez','2021-02-08','Merida','Yucatan',
'1234564348'),(1002,'Carlos Miguel','Lopez','Perez','2020-03-15','Morelia','Michoacan',
'1234564349'),(1003,'Maria Carlota','SAnchez','Perez','2018-02-02','Guasave','Sinaloa',
'1234564322'),(1004,'Casandra','Gavilan','Gonzalez','2021-07-25','Monterrey','Nuevo Leon',
'1234564335'),(1005,'Andrea','Davila','Antonios','2018-06-02','Guadalajara','Jalisco',
'1234564326'),(1006,'Joao','Aguiar','Garza','2015-03-15','Morelia','Michoacan',
'1234564327'),(1007,'Daniel','Zambrano','Espino','2015-07-18','Toluca','Estado de Mexico',
'1234564328'),(1008,'Flor','Velazquez','Espinoza','2017-02-08','Guadalajara','Jalisco',
'1234564345'),(1009,'Celeste','Vazquez','De la O','2015-08-22','Tijuana','Baja California',
'1234564385'),(1010,'Abigail','Andrade','Beltran','2020-05-12','Guadalajara','Jalisco',
'1234564373'),(1011,'Juan Carlos','Espinoza','Campos','2020-05-15','Tijuana','Baja California',
'1234564399'),(1012,'Dionicio','Espino','Espinoza','2021-06-15','Guadalajara','Jalisco',
'1234564398'),(1013,'Jose Carlos','Flores','Garcia','2021-07-17','Guasave','Sinaloa',
'1234564390'),(1014,'Jose Pedro','Valle','Perez','2021-08-01','Mazatlan','Sinaloa',
'1234564312'),(1015,'Miguel Luis','Flores','Sanchez','2021-01-15','M;onterrey','Nuevo Leon',
'1234564315'),(1016,'JoseMarcelo','Gonzalez','Miranda','2018-05-12','Guadalajara','Jalisco',
'1234564222'),(1017,'Flor Estela','Huerta','Espinosa','2018-07-09','Guadalajara','Jalisco',
'1234564555'),(1018,'Cristian Jesus','Kilberth','Perez','2018-01-08','Ensenada','Baja California',
'1234564532'),(1019,'Maria Cecilia','Lopez','Lopez','2045-07-28','Guadalajara','Jalisco',
'1234564145'),(1020,'Juan Alberto','Martinez','Vazquez','2016-07-22','Guadalajara','Jalisco',
'1234564142'),(1021,'Franchesco Daniel','Nunez','Perez','2017-07-15','Puerto Vallarta','Jalisco',
'1234564248'),(1022,'Laura','Quinonez','Garcia','2020-02-08','Puebla','Puebla',
'1234564788');

*--- Ahora, creamos otra tabla llamada sucursales e insertamos los siguientes datos ---*

CREATE TABLE sucursales(
	municipio varchar(45),
  	estado varchar(45)
 );
 
 *--- Como nos olvidamos de agregar la columna numsucursal, la agregamos ejecutando 
 el siguiente comando: ---*
 
 ALTER TABLE sucursales ADD COLUMN numsucursal INTEGER
 
 *--- Ahora si, insertamos los siguientes datos: ---* 
 
  INSERT INTO sucursales(municipio,estado,numsucursal) VALUES
 ('Guadalajara','Jalisco',1),
  ('Merida','Yucatan',7),
  ('Morelia','Michoacan',4),
  ('Guasave','Sinaloa',5),
  ('Monterrey','Nuevo Leon',3),
  ('Toluca','Estado de Mexico',11),
  ('Tijuana','Baja California',8),
  ('Mazatlan','Sinaloa',6),
  ('Ensenada','Baja California',9),
  ('Puerto Vallarta','Jalisco',2),
  ('Puebla','Puebla',10),
  ('Celaya','Guanajuato',12)

 *--- Ahora, si vemos la tabla vendedor, observamos que
 para cada vendedor tiene su respectiva ciudad/municipio y estado.
 Por lo tanto, como la tabla sucursales tiene un numero de sucursal
 y el nombre y el estado de la ciudad, podemos borrar las columnas
 ciudad y estado de la tabla vendedores, crear una nueva columna en 
 vendedores llamada num_sucursal y conectarla con la informacion de
 la tabla sucursales para cada empleado. ---*


*--- Elimino las columnas ciudad y estado de vendedor ---*

ALTER TABLE vendedor DROP ciudad;
ALTER TABLE vendedor DROP estado;

*--- Agrego la columna num_sucursal en la tabla vendedor ---*

ALTER TABLE vendedor ADD COLUMN num_sucursal INTEGER;

*--- Ahora, actualizo los valores de num_sucursal de la siguiente manera: ---*

UPDATE vendedor SET num_sucursal=2 WHERE id=1000;
UPDATE vendedor SET num_sucursal=4 WHERE id=1001;
UPDATE vendedor SET num_sucursal=1 WHERE id=1002;
UPDATE vendedor SET num_sucursal=3 WHERE id=1003;
UPDATE vendedor SET num_sucursal=11 WHERE id=1004;
UPDATE vendedor SET num_sucursal=12 WHERE id=1005;
UPDATE vendedor SET num_sucursal=9 WHERE id=1006;
UPDATE vendedor SET num_sucursal=10 WHERE id=1007;
UPDATE vendedor SET num_sucursal=8 WHERE id=1008;
UPDATE vendedor SET num_sucursal=5 WHERE id=1009;
UPDATE vendedor SET num_sucursal=6 WHERE id=1010;
UPDATE vendedor SET num_sucursal=7 WHERE id=1011;
UPDATE vendedor SET num_sucursal=2 WHERE id=1012;
UPDATE vendedor SET num_sucursal=4 WHERE id=1013;
UPDATE vendedor SET num_sucursal=1 WHERE id=1014;
UPDATE vendedor SET num_sucursal=3 WHERE id=1015;
UPDATE vendedor SET num_sucursal=11 WHERE id=1016;
UPDATE vendedor SET num_sucursal=12 WHERE id=1017;
UPDATE vendedor SET num_sucursal=9 WHERE id=1018;
UPDATE vendedor SET num_sucursal=10 WHERE id=1019;
UPDATE vendedor SET num_sucursal=8 WHERE id=1020;
UPDATE vendedor SET num_sucursal=5 WHERE id=1021;
UPDATE vendedor SET num_sucursal=6 WHERE id=1022;
UPDATE vendedor SET num_sucursal=7 WHERE id=1023;

*--- Por ultimo, vemos los datos unidos de ambas tablas
(la tabla vendedor con la tabla sucursales) mediante el 
uso de JOIN ---*

SELECT v.nombre, v.apellidopaterno, v.num_sucursal, s.municipio, s.estado
FROM vendedor v
JOIN sucursales s
ON v.num_sucursal = s.numsucursal
ORDER BY v.num_sucursal

*--- Ahora, vamos a crear una tabla 'cantsucursal' que va a mostrar 
cuantos vendedores hay por sucursal ---*

CREATE TABLE cantsucursal
AS SELECT v.num_sucursal, COUNT(v.num_sucursal) AS cant_por_sucursal
FROM vendedor v
JOIN sucursales s
ON v.num_sucursal = s.numsucursal
GROUP BY v.num_sucursal
ORDER BY v.num_sucursal

*--- En este caso, creamos una tabla cantsucursal donde 
tiene las columnas v.num_sucursal (muestra las distintas sucursales)
y la columna cant_por_sucursal que cuenta la cantidad de vendedores 
por sucursal de la tabla vendedor v uniendola con la tabla sucursales s
donde v.num_sucursal = s.numsucursal, se agrupan por v.num_sucursal y 
se ordenan por v.num_sucursal de manera ascendente --*


*--- Nueva Seccion: Insertar datos en una tabla buscando un valor en otra tabla,
es decir, vamos a combinar el comando INSERT con SELECT ---*

SELECT * FROM libros
SELECT * FROM editorial

INSERT INTO libros(codigo, titulo, autor, codigoeditorial, precio, cantidad)
SELECT 10041, 'La perdida del baston', 'Dionicio Castillo', codigo_editorial , 250.9, 6
FROM editorial
WHERE nombreeditorial='Mexico'

*--- De esta manera, logramos insertar en la tabla libros los datos indicados en el SELECT
pero donde el valor de la columna codigoeditorial se extrae de la columna codigo_editorial
correspondiente a la tabla editorial donde su valor es el asocialdo al 
nombreeditorial='Mexico' (codigo_editorial = 220) ---*

*--- Ahora, vamos a insertar en la tabla vendedor, un vendedor con id 1023 
donde la numero de sucursal sea la correspondiente a municipio = Ensenada ---*

INSERT INTO vendedor(id, nombre, apellidopaterno, apellidomaterno, antiguedad, telefono, num_sucursal)
SELECT 1023, 'Lorenzo', 'Gamez', 'Lu', '2020-08-02', '2222222222', numsucursal
FROM sucursales
WHERE municipio = 'Ensenada';

*--- Nueva seccion: INSERT INTO con SELECT. Vamos a realizar inserciones con una tabla ya creada. ---*

*--- Comenzamos creando la tabla alumnossobresalientes ---*

CREATE TABLE alumnossobresalientes(
	numcontrol BIGINT,
	nombre VARCHAR(45),
	apellidopaterno VARCHAR(45),
	apellidomaterno VARCHAR(45),
	fechaingreso TEXT,
	carrera VARCHAR(45),
	promedio DECIMAL(6,2)
);

INSERT INTO alumnossobresalientes(numcontrol, nombre, apellidopaterno, apellidomaterno, fechaingreso, carrera, promedio)
SELECT DISTINCT(numcontrol), nombre, apellidopaterno, apellidomaterno, fechaingreso, carrera, promedio
FROM alumnos
WHERE promedio >= 90

*-- De esta manera, insertamos en la tabla alumnossobresalientes a aquellos alumnos cuyo promedio 
es mayor o igual que 90 --*

*-- Nueva secccion: Actualizar datos de una tabla con valores de otra tabla.
Para ello, vamos a combinar UPDATE con JOIN --*

*-- Anteriormente, habiamos eliminado las columnas municipio y estado de la tabla Vendedor.
Para este ejemplo, vamos a volver a agregarlas. --*

ALTER TABLE vendedor ADD COLUMN municipio VARCHAR(45);
ALTER TABLE vendedor ADD COLUMN estado VARCHAR(45);

*-- Ahora, vamos a modificar la tabla vendedor para que almacene los nombres del nombre
y el municipio donde trabaja el vendedor de la siguiente manera: --*

UPDATE vendedor AS v
SET municipio = s.municipio 
FROM sucursales AS s
WHERE v.num_sucursal = s.numsucursal

UPDATE vendedor AS v
SET estado = s.estado 
FROM sucursales AS s
WHERE v.num_sucursal = s.numsucursal

*-- Por lo tanto, actualizamos la tabla vendedor en el campo municipio 
de la tabla sucursales donde el numero de sucursal de la tabla vendedor 
coincida con el numero de sucursal de la tabla sucursales. Analogo, para
la columna estado --*

SELECT * FROM vendedor
SELECT * FROM sucursales

 