Agrupar registros. Clausula GROUP BY.

La clausula GROUP BY la cual nos va a permitir agrupar filas que van a tener el 
mismo resultado.  

*-- Comenzamos creando la tabla 'personas' con las siguientes columnas --*

CREATE TABLE personas(
	dni VARCHAR(8),
	nombre VARCHAR(45),
	apellidopaterno VARCHAR(45),
	apellidomaterno VARCHAR(45),
	fechanacimiento DATE,
	municipio VARCHAR(45),
	estado VARCHAR(45),
	telefono VARCHAR(12),
	sexo CHARACTER(1)
);

*-- Luego, le insertamos los siguientes datos: --*

INSERT INTO personas(dni,nombre,apellidopaterno,apellidomaterno,fechanacimiento,municipio,estado,telefono,sexo)
 VALUES('100012A','Juan','Vazquez','Perez','2020-05-08','Guadalajara', 'Jalisco','1234564343','M'),
('1001B12','Juan','Vazquez','Perez','2021-02-08','Merida','Yucatan','1234564348','M'),
('1002W12','Carlos Miguel','Lopez','Perez','2020-03-15','Morelia','Michoacan','1234564349','M'),
('1003Q43','Maria Carlota','SAnchez','Perez','2018-02-02','Guasave','Sinaloa','1234564322','F'),
('1004S23','Casandra','Gavilan','Gonzalez','2021-07-25','Monterrey','Nuevo Leon','1234564335','F'),
('1005F32','Andrea','Davila','Antonios','2018-06-02','Guadalajara','Jalisco','1234564326','F'),
('1006H78','Joao','Aguiar','Garza','2015-03-15','Morelia','Michoacan','1234564327','M'),
('1007Y54','Daniel','Zambrano','Espino','2015-07-18','Toluca','Estado de Mexico','1234564328','M'),
('1008W43','Flor','Velazquez','Espinoza','2017-02-08','Guadalajara','Jalisco','1234564345','F'),
('1009W23','Celeste','Vazquez','De la O','2015-08-22','Tijuana','Baja California','1234564385','F'),
('1010W12','Abigail','Andrade','Beltran','2020-05-12','Guadalajara','Jalisco','1234564373','F'),
('1011Q25','Juan Carlos','Espinoza','Campos','2020-05-15','Tijuana','Baja California','1234564399','M'),
('1012W25','Dionicio','Espino','Espinoza','2021-06-15','Guadalajara','Jalisco','1234564398','F'),
('1013Q45','Jose Carlos','Flores','Garcia','2021-07-17','Guasave','Sinaloa','1234564390','M'),
('1014Y59','Jose Pedro','Valle','Perez','2021-08-01','Mazatlan','Sinaloa','1234564312','M'),
('1015P45','Miguel Luis','Flores','Sanchez','2021-01-15','Monterrey','Nuevo Leon','1234564315','M'),
('1016H89','JoseMarcelo','Gonzalez','Miranda','2018-05-12','Guadalajara','Jalisco','1234564222','M'),
('1017278','Flor Estela','Huerta','Espinosa','2018-07-09','Guadalajara','Jalisco','1234564555','F'),
('1018Q34','Cristian Jesus','Kilberth','Perez','2018-01-08','Ensenada','Baja California','1234564532','F'),
('1019W47','Maria Cecilia','Lopez','Lopez','2045-07-28','Guadalajara','Jalisco','1234564145','F'),
('1020P30','Juan Alberto','Martinez','Vazquez','2016-07-22','Guadalajara','Jalisco','1234564142','M'),
('1021Q25','Franchesco Daniel','Nunez','Perez','2017-07-15','Puerto Vallarta','Jalisco','1234564248','M'),
('1022F78','Laura','Quinonez','Garcia','2020-02-08','Puebla','Puebla','1234564788','F');


*-- Ahora, queremos ver cuantas personas hay por sexo, es decir, cuantas
son mujeres y cuantos son hombres. Para ello, comenzamos ejecutando 
el siguiente comando: --*

SELECT COUNT(*) FROM personas

*-- De esta manera, contamos todos (*) los registros/personas que
tiene la tabla 'personas'. --*

*-- Por lo tanto, si ejecutamos: --*

SELECT COUNT(*) FROM personas GROUP BY sexo

*-- Obtenemos la cantidad de personas del sexo masculino y femenino
de la tabla personas pero no sabemos a que genero corresponde (solo
obtenemos los valores 12 y 11) --*

*-- Por lo tanto, si agregamos la columna sexo vamos a poder determinar
a que genero pertenecen. --*

SELECT sexo, COUNT(*) AS cant_por_sexo FROM personas GROUP BY sexo

*-- Ahora, para calcular cuantas personas hay por 'estado' ejecutamos
el siguiente comando: --*

SELECT estado, COUNT(*) AS cant_por_estado 
FROM personas 
GROUP BY estado 
ORDER BY estado

*-- Ejercicio 2. Comenzamos creando la tabla libros e insertando los 
siguientes datos: --*

CREATE TABLE libros(
	codigo INTEGER,
	titulo VARCHAR(40),
	autor VARCHAR(30),
	codigoeditorial INTEGER,
	precio DECIMAL(5,2),
	cantidad SMALLINT
);

INSERT INTO libros(codigo,titulo, autor,codigoeditorial,precio,cantidad)
VALUES(10001,'el aleph','Borges',220,450,5),
(10002,'El conejito','Flors',221,200.5,2),
(10003,'El elefante','De la Rosa',222,100.5,3),
(10004,'Sor Juana','Juan Galileo',223,400,4),
(10005,'La Bella','Flors',224,500.5,1),
(10006,'Los zapatos de Juana','Camilo Rosas',225,100,1),
(10007,'Tasa de café','Anastacia Arco',226,200.5,1),
(10008,'Los pecesitos','Cristina Tomás',227,100.5,2),
(10009,'El sueño dorado','Ana Camello',228,99.9,2),
(10010,'Andrés','Andrés Camareno',229,200.5,4),
(10011,'Tasa de café 2','Anastacia Arco',230,200.5,1),
(10012,'LA tortuga','María Booleana',231,85.9,null),
(10013,'a felicidad','Gise Esmeralda',232,600.5,null),
(10014,'Encontrando a Nemo',',Marcos Marcos',233,200.5,2),
(10015,'El arcoiris','Antonio Town',234,800.5,null),
(10016,'Programación web extensa','Mauricio Pérez',235,100.5,null),
(10017,'Sin ti','Lorena Garza',236,200.5,null);

*-- Ahora, queremos saber cuantos libros tiene cada editorial.
Para ello ejecutamos el siguiente comando: --*

SELECT codigoeditorial, COUNT(*) AS cant_libros_por_editorial 
FROM libros 
GROUP BY codigoeditorial

*-- Ahora, queremos saber por cada editorial, cual es el libro
con mayor y menor precio. Para ello ejecutamos el siguiente comando: --*

SELECT codigoeditorial, 
MAX(precio) AS max_precio_libro_por_editorial,
MIN(precio) AS min_precio_libro_por_editorial
FROM libros 
GROUP BY codigoeditorial
ORDER BY codigoeditorial


*-- Ahora, queremos saber cuantos libros por editorial tienen el 
precio entre 100 y 300. Para ello ejecutamos el siguiente comando: --*

SELECT codigoeditorial, COUNT(*) AS  cant_libros_en_rango
FROM libros 
WHERE precio BETWEEN 100 AND 300 
GROUP BY codigoeditorial
ORDER BY codigoeditorial 

*-- Por ultimo, si queremos saber ademas cual es el precio y el titulo del
producto, agregamos las siguientes lineas: --*

SELECT codigoeditorial, precio, titulo, COUNT(*) AS  cant_libros_en_rango
FROM libros 
WHERE precio BETWEEN 100 AND 300 
GROUP BY codigoeditorial, precio, titulo
ORDER BY codigoeditorial 











